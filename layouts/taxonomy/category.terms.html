{{ partial "head.html" . }}
  <body>
    <div id="blog">
      {{ partial "header.html" . }}
      {{ partial "sidebar.html" . }}
      {{ partial "post/header-cover.html" . }}
      
      <div id="main" data-behavior="{{ .Scratch.Get "sidebarBehavior" }}"
        class="{{ with .Params.coverImage }}hasCover{{ end }}
               {{ if eq .Params.coverMeta "out" }}hasCoverMetaOut{{ else }}hasCoverMetaIn{{ end }}
               {{ with .Params.coverCaption }}hasCoverCaption{{ end }}">
        
        <section class="main-content-wrap glass-portfolio">
          <div class="portfolio-content">
            <h2 class="category-title">{{ i18n "taxonomy.knowledge_domains" | upper }}</h2>
            
            <div class="cards-container knowledge-grid">
              {{/* Custom Order Logic */}}
              {{ $categories := .Site.Taxonomies.categories }}
              {{ $orderedList := slice }}
              {{ $preferredOrder := slice "專業技術" "研究所論文" "研究生專題" "大學生專題" }}

              {{/* 1. Add preferred items first */}}
              {{ range $preferredOrder }}
                {{ $key := . }}
                {{ with (index $categories $key) }}
                  {{ $orderedList = $orderedList | append (dict "Name" $key "Taxonomy" .) }}
                {{ end }}
              {{ end }}

              {{/* 2. Add remaining items */}}
              {{ range $key, $val := $categories }}
                {{ if not (in $preferredOrder $key) }}
                  {{ $orderedList = $orderedList | append (dict "Name" $key "Taxonomy" $val) }}
                {{ end }}
              {{ end }}

              {{/* 3. Render Final List */}}
              {{ range $orderedList }}
                {{ $name := .Name }}
                {{ $taxonomy := .Taxonomy }}
                
                {{/* Get the latest page safely */}}
                {{ $latestPage := "" }}
                {{ range first 1 $taxonomy.Pages }}
                  {{ $latestPage = . }}
                {{ end }}
                
                <a href="{{ $taxonomy.Page.RelPermalink }}" class="glass-card knowledge-tile" style="display: flex;">
                  <div class="tile-header">
                    <h3 class="tile-title">{{ $name | humanize }}</h3>
                    <span class="tile-count">{{ $taxonomy.Count }} {{ i18n "taxonomy.posts_count" }}</span>
                  </div>
                  
                  <div class="tile-body">
                    {{ if $latestPage }}
                    <div class="latest-snapshot">
                      <span class="snapshot-label">{{ i18n "taxonomy.latest" }}</span>
                      <p class="snapshot-title">{{ $latestPage.Title }}</p>
                      <span class="snapshot-date">{{ $latestPage.Date.Format "Jan 2, 2006" }}</span>
                    </div>
                    {{ end }}
                  </div>
                  
                  <div class="tile-footer">
                     <span class="explore-link">{{ i18n "taxonomy.explore_domain" }}</span>
                  </div>
                </a>
              {{ end }}
            </div>

          </div>
        </section>

        {{ partial "footer.html" . }}
      </div>
    </div>
    {{ partial "foot.html" . }}
